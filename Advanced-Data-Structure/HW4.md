# HW4

### 插入操作然后维持五个性质

1. 为什么插入结点为红色？

   答：如果插入的结点是黑色，会导致当前路径上的黑高发生变化，一定会需要调整颜色或者树的形态。而当插入结点为红色时，不会改变树的黑高，因此无需立马调整树的颜色、形态，只有在出现双红的情况才会需要调整。即设插入的结点为红色简化了插入操作，减少了违法性质的可能性。

   具体效果：插入红结点避免影响当前链的黑高。

2. 当插入结点的父节点为红色，如何操作可恢复改性质。

   答：如果出现了双红的情况，由于父结点是红色，因此祖父结点一定是黑色，对叔叔结点的颜色分两种情况进行讨论：

   1. 新插入结点的叔叔结点是黑色

      把新插入的结点、父结点以及祖父结点拍扁，重新构造（局部“3+4”重构）这部分树的形态为一个根为黑色，两个子结点为红色，孙结点均为黑色的树（叔叔结点下放到孙结点一层）。

      具体效果：

      做旋转（拍扁重构）：某一侧的黑高失衡，使其平衡，维持性质5.

      重新染色：使这个子树上的黑高保持不变，同时维持性质4，没有两个连续的红结点。

   2. 新插入结点的叔叔结点是红色

      进行一个类似于B树分裂的操作，将祖父结点变为红色，父结点与叔叔结点均染为黑色，然后将祖父结点当做新插入的结点，递归处理新引入的双红的情况。如果递归到了树根处，则将根染为黑色，红黑树整体的黑高加一。

      将祖父染红：满足性质4，防止两个连续红色节点。

      将父亲、叔叔节点染黑：满足性质5，使子树上的黑高保持不变。

      向上递归：维持性质4，防止祖父染红后与祖先结点产生连续的两个红色节点。

      将根染黑：维持性质2，保持根为黑色。



### 红黑树的本质是一个 2-3-4 树

​		如果将每一个红色的节点都向上与黑色父结点合并到同一层，则可以发现这个有唯一黑色结点的大结点成为了 2-3-4树的一个结点，而且一个大结点中的结点个数不超过三个，并且可以将原小节点中的值作为这棵2-3-4树的关键值。这样就把红黑树和一个 2-3-4树对应起来了。

​		但是，由于红黑树会做一些旋转的操作，而B树不会，因此在大量连续查询需求需要存入缓存时，红黑树的效率还是不如 B树 的。



### 红黑树顺序和乱序插入的影响

​		顺序插入的方式会导致红黑树的树高比在乱序插入的情况下更高，因此会导致查找的时间复杂度比较高，从而导致性能下降。因此乱序插入是更适合于红黑树的插入形式。